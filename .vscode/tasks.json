{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "CMake: Build",
            "type": "cmake",
            "command": "build",
            "targets": [
                "all"
            ],
            "dependsOn": "CMake: Configure",
            "problemMatcher": {
                "base": "$gcc",
                "fileLocation": ["absolute"]
            },
            "group": {
                "kind": "build",
                "isDefault": true
            },
        },
        {
            "label": "CMake: Configure",
            "type": "cmake",
            "command": "configure",
            "targets": [
                "all"
            ],
            "runOptions": {
                "runOn": "folderOpen"
            },
            "dependsOn": "Conan: Install",
            "problemMatcher": [],
        },
        {
            "label": "CMake: Clean",
            "type": "cmake",
            "command": "clean",
            "targets": [
                "all"
            ],
            "dependsOn": [
                "Valgrind: Clean Memcheck",
                "Valgrind: Clean Callgrind",
                "Valgrind: Clean Cachegrind",
            ],
            "problemMatcher": [],
        },
        {
            "label": "Conan: Install",
            "hide": false,
            "command": "conan",
            "args": [
                "install",
                "build/${command:cmake.buildType}/conanfile.txt",
                "--build=missing",
                "--settings",
                "build_type=${command:cmake.buildType}"
            ],
            "dependsOn": "Conan: Setup",
            "problemMatcher": []
        },
        {
            "label": "Conan: Setup",
            "hide": true,
            "linux": {
                "command": "cp",
                "args": [
                    "conanfile.txt",
                    "${workspaceFolder}/build/${command:cmake.buildType}/"
                ]
            },
            "dependsOn": "Create Build Directory",
            "problemMatcher": []
        },
        {
            "label": "Create Build Directory",
            "hide": true,
            "linux": {
                "command": "mkdir",
                "args": [
                    "-p",
                    "${workspaceFolder}/build/${command:cmake.buildType}"
                ]
            },
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Show Memcheck Report",
            "command": "code",
            "args": [
                "-r",
                "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.valgrind"
            ],
            "dependsOn": "Valgrind: Make Memcheck Report",
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Show Callgrind Report",
            "command": "${command:workbench.action.closeActiveEditor}",
            "dependsOn": "Valgrind: Wait for Callgrind Report File",
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Wait for Callgrind Report File",
            "hide": true,
            "linux": {
                "command": "sleep",
                "args": [
                    "0.1s"
                ],
            },
            "dependsOn": "Valgrind: Open Callgrind Report File",
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Open Callgrind Report File",
            "hide": true,
            "command": "code",
            "args": [
                "-r",
                "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.callgrind.dot"
            ],
            "dependsOn": "Valgrind: Convert Callgrind Report To Chart",
            "problemMatcher": []
        },

        {
            "label": "Valgrind: Show Cachegrind Report",
            "command": "code",
            "args": [
                "-r",
                "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.cachegrind.valgrind"
            ],
            "dependsOn": "Valgrind: Generate Cachegrind Report",
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Generate Cachegrind Report",
            "hide": true,
            "linux": {
                "command": "bash",
                "args": [
                    "-c",
                    "cg_annotate ${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.cachegrind $(echo $(find ${workspaceFolder} -name '*.cpp' -o -name '*.c' -o -name '*.cc' -o -name '*.h' -o -name '*.hpp')) > ${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.cachegrind.valgrind"
                ]
            },
            "dependsOn": "Valgrind: Make Cachegrind Report",
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Convert Callgrind Report To Chart",
            "hide": true,
            "command": "gprof2dot",
            "args": [
                "--format=callgrind",
                "--output=${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.callgrind.dot",
                "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.callgrind"
            ],
            "dependsOn": "Valgrind: Make Callgrind Report",
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Make Memcheck Report",
            "hide": true,
            "command": "valgrind",
            "options": {
                "cwd": "${workspaceFolder}/build/${command:cmake.buildType}"
            },
            "args": [
                "--tool=memcheck",
                "--leak-check=full",
                "--show-leak-kinds=all",
                "--track-origins=yes",
                "--verbose",
                "--log-file=${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.valgrind",
                "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}"
            ],
            "dependsOn": [
                "Valgrind: Clean Memcheck",
                "C++ Project: CMake Build Debug"
            ],
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Make Callgrind Report",
            "hide": true,
            "command": "valgrind",
            "options": {
                "cwd": "${workspaceFolder}/build/${command:cmake.buildType}"
            },
            "args": [
                "--tool=callgrind",
                "--dump-instr=yes",
                "--collect-jumps=yes",
                "--callgrind-out-file=${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.callgrind",
                "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}"
            ],
            "dependsOn": [
                "Valgrind: Clean Callgrind",
                "C++ Project: CMake Build Debug"
            ],
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Make Cachegrind Report",
            "hide": true,
            "command": "valgrind",
            "options": {
                "cwd": "${workspaceFolder}/build/${command:cmake.buildType}"
            },
            "args": [
                "--tool=cachegrind",
                "--cachegrind-out-file=${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.cachegrind",
                "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}"
            ],
            "dependsOn": [
                "Valgrind: Clean Cachegrind",
                "CMake: Build"
            ],
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Clean Memcheck",
            "hide": true,
            "linux": {
                "command": "rm",
                "args": [
                    "-f",
                    "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.valgrind"
                ]
            },
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Clean CallGrind",
            "hide": true,
            "linux": {
                "command": "rm",
                "args": [
                    "-f",
                    "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.callgrind",
                    "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.callgrind.dot",
                    "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.callgrind.svg"
                ]
            },
            "problemMatcher": []
        },
        {
            "label": "Valgrind: Clean Cachegrind",
            "hide": true,
            "linux": {
                "command": "rm",
                "args": [
                    "-f",
                    "${workspaceFolder}/build/${command:cmake.buildType}/${workspaceFolderBasename}.cachegrind.valgrind"
                ]
            },
            "problemMatcher": []
        },
    ]
}
